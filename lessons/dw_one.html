<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="/edh7916/assets/css/style.css">
<link rel="stylesheet" href="/edh7916/assets/css/syntax_default.css">
<link rel="shortcut icon" type="image/png" href="/edh7916/assets/img/favicon.ico">
<link crossorigin="anonymous" media="all" integrity="sha512-uhAd27cNiLn0VE2GVEVUN8D5zW0o7s0QTnCGMnJZkL2HqN9/LwHDi4ndTPJH0upUQHYl/8QF6cwbOYp/KIzlJQ==" rel="stylesheet" href="https://github.githubassets.com/assets/github-be4e45349cf088df7a6636f437c0a167.css" />
<script defer src="/edh7916/assets/js/all.min.js"></script>
<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<title>edquant | EDH 7916: Contemporary Research in Higher Education</title>

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>EDH 7916: Contemporary Research in Higher Education<a href="https://github.com/btskinner/edh7916" class="iconlink">
	      <i class="fab fa-github fa-sm"></i></a></h1>
	<h2 class="thin">Spring 2020</h2>
	<p>A course in quantitative research workflow for students in
the higher education administration program at the University of Florida
</p>
	<!-- side / top bar menu -->
	<h2 class="thin">
	  <a href="/edh7916/">Overview</a></br>
	  <a href="/edh7916/syllabus/">Course
	    information</a></br>
	  <a href="/edh7916/location/">Meeting
	    location</a></br>
	  <a href="/edh7916/start/">Getting started</a></br>
	  <a href="/edh7916/schedule/">Schedule</a></br>
	  <a href="/edh7916/lessons/">Lessons</a></br>
	  <a href="/edh7916/assignments/">Assignments</a></br>
	  <a href="/edh7916/questions/">Questions</a></br>
	  <a href="/edh7916/about/">About</a></br>	  
	</h2>
      </header>

      <section>
	<h1>Data Wrangling I: Enter the {tidyverse}</h1>
	

	
<p>
  
  <a href="/edh7916/assets/pdf/dw_one.pdf"
     class="iconlink" download title="Get PDF of lesson">
  <i class="far fa-file-pdf fa-2x"></i>
  </a>
  
  &nbsp;&nbsp;
  
  <a href="/edh7916/scripts/dw_one.R"
     class="iconlink" download title="Get script">
    <i class="fas fa-code fa-2x"></i>
  </a>
  &nbsp;&nbsp;
  
  
  
  
  <a href="/edh7916/data/hsls_small.csv"
     class="iconlink" download title="Get data">
    <i class="fas fa-database fa-2x"></i>
  </a>
  
</p>


<p>Large or small, a typical data analysis project will involve most — if
not all — of the following steps:</p>

<ol>
  <li><strong>Read</strong> in data</li>
  <li><strong>Select</strong> variables (columns)</li>
  <li><strong>Mutate</strong> data into new forms</li>
  <li><strong>Filter</strong> observations (rows)</li>
  <li><strong>Summarize</strong> data</li>
  <li><strong>Arrange</strong> data</li>
  <li><strong>Write</strong> out updated data</li>
</ol>

<p>Returning to our cooking metaphor from last lesson, if the first and
last steps represent our raw ingredients and finished dish,
respectively, then the middle steps are the core techniques we use to
prepare the meal.</p>

<p>As you can see, there aren’t that many. (There are, of course, many
specialized tools for specialized tasks — too many to cover in this
course.) But the power of the core techniques comes from the infinite
ways they can be ordered and combined.</p>

<h1 id="tidyverse">Tidyverse</h1>

<p>The tidyverse is shorthand for a <a href="https://www.tidyverse.org/packages/">number of
packages</a> that are built to work
well together and can be used in place of base R functions. A few of the
tidyverse packages that you will often use are:</p>

<ul>
  <li><a href="https://dplyr.tidyverse.org">dplyr</a> for data manipulation</li>
  <li><a href="https://tidyr.tidyverse.org">tidyr</a> for making data
<a href="https://vita.had.co.nz/papers/tidy-data.html">tidy</a></li>
  <li><a href="https://readr.tidyverse.org">readr</a> for flat file I/O</li>
  <li><a href="https://readxl.tidyverse.org">readxl</a> for Excel file I/O</li>
  <li><a href="https://haven.tidyverse.org">haven</a> for other file format I/O</li>
  <li><a href="https://ggplot2.tidyverse.org">ggplot2</a> for making graphics</li>
  <li><a href="https://stringr.tidyverse.org">stringr</a> for working with strings</li>
  <li><a href="https://lubridate.tidyverse.org">lubridate</a> for working with
dates</li>
  <li><a href="http://purrr.tidyverse.org">purrr</a> for working with functions</li>
</ul>

<p>Many R users find functions from these libraries to be more intuitive
than base R functions. In some cases, tidyverse functions are faster
than base R, which is an added benefit when working with large data
sets.</p>

<p>Today we will focus on functions from the <strong>{dplyr}</strong> and <strong>{readr}</strong>
libraries.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## ---------------------------</span><span class="w">
</span><span class="c1">## libraries</span><span class="w">
</span><span class="c1">## ---------------------------</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──

✔ ggplot2 3.2.1     ✔ purrr   0.3.3
✔ tibble  2.1.3     ✔ dplyr   0.8.3
✔ tidyr   1.0.0     ✔ stringr 1.4.0
✔ readr   1.3.1     ✔ forcats 0.4.0

── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
</code></pre></div></div>

<h1 id="check-working-directory">Check working directory</h1>

<p>This script — unlike the others we’ve used so far — assumes that you are
in the <code class="language-plaintext highlighter-rouge">scripts</code> directory, one down from top-level project directory.
You can check by typing <code class="language-plaintext highlighter-rouge">getwd()</code> in the R console. If your path is
anything other than <code class="language-plaintext highlighter-rouge">&lt;path&gt;/&lt;to&gt;/edh7916/scripts</code> (or whatever you’ve
named your <code class="language-plaintext highlighter-rouge">student_&lt;last_name&gt;</code> repo), then use the R command <code class="language-plaintext highlighter-rouge">setwd()</code>
with relative paths to get where you need to be.</p>

<p>For example, if I run <code class="language-plaintext highlighter-rouge">getwd()</code> and see <code class="language-plaintext highlighter-rouge">~/courses/edh7916</code>, that means
my working directory is the top-level, not <code class="language-plaintext highlighter-rouge">scripts</code>. I can get to the
right spot by typing <code class="language-plaintext highlighter-rouge">setwd("./scripts")</code> in the console: it tells R, go
down one level into (<code class="language-plaintext highlighter-rouge">./scripts</code>) and make that the working directory.
Were I to run <code class="language-plaintext highlighter-rouge">getwd()</code> afterwards, I should see
<code class="language-plaintext highlighter-rouge">~/courses/edh7916/scripts</code>.</p>

<p>You may not need to do this. But if you open RStudio using the <strong>Open
Project</strong> menu above the upper-right panel, you most likely will be in
the top-level project directy — not quite right. Checking and setting
your working directory at the start of a session is a pain, but is a
useful skill for when you work with collaborators across multiple
projects.</p>

<p><strong>Notice</strong> that I’m not setting (<em>i.e.</em> hard coding) the working
directory in the script. That would not work well for sharing the code.
Instead, I tell you where you need to be (a common landmark), let you
get there, and then rely on relative paths afterwards.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## ---------------------------</span><span class="w">
</span><span class="c1">## directory paths</span><span class="w">
</span><span class="c1">## ---------------------------</span><span class="w">

</span><span class="c1">## assume we're running this script from the ./scripts subdirectory</span><span class="w">
</span><span class="n">dat_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="s2">".."</span><span class="p">,</span><span class="w"> </span><span class="s2">"data"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h1 id="read-in-data"><strong>Read</strong> in data</h1>

<p>So far, we’ve only used small nonce data sets. For this lesson, we’ll
use a subset of the <a href="https://nces.ed.gov/surveys/hsls09/">High School Longitudinal Study of 2009
(HSLS09)</a>, an IES / NCES data set
that features:</p>

<blockquote>
  <ul>
    <li>Nationally representative, longitudinal study of 23,000+ 9th
graders from 944 schools in 2009, with a first follow-up in 2012
and a second follow-up in 2016</li>
    <li>Students followed throughout secondary and postsecondary years</li>
    <li>Surveys of students, their parents, math and science teachers,
school administrators, and school counselors</li>
    <li>A new student assessment in algebraic skills, reasoning, and
problem solving for 9th and 11th grades</li>
    <li>10 state representative datasets</li>
  </ul>
</blockquote>

<p>If you are interested in using HSLS09 for future projects, <strong>DO NOT</strong>
rely on this subset. Be sure to download the full data set with all
relevant variables and weights if that’s the case. But for our purposes
in this lesson, it will work just fine.</p>

<p>Throughout, we’ll need to consult the code book. An <a href="https://nces.ed.gov/OnlineCodebook/">online version can
be found at this link (after a little
navigation)</a>.</p>

<blockquote>
  <h4 id="quick-exercise">Quick exercise</h4>

  <p>Follow the codebook link above in your browser and navigate to the
HSLS09 codebook.</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## ---------------------------</span><span class="w">
</span><span class="c1">## input</span><span class="w">
</span><span class="c1">## ---------------------------</span><span class="w">

</span><span class="c1">## data are CSV, so we use readr::read_csv()</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">dat_dir</span><span class="p">,</span><span class="w"> </span><span class="s2">"hsls_small.csv"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Parsed with column specification:
cols(
  stu_id = col_double(),
  x1sex = col_double(),
  x1race = col_double(),
  x1stdob = col_double(),
  x1txmtscor = col_double(),
  x1paredu = col_double(),
  x1hhnumber = col_double(),
  x1famincome = col_double(),
  x1poverty185 = col_double(),
  x1ses = col_double(),
  x1stuedexpct = col_double(),
  x1paredexpct = col_double(),
  x1region = col_double(),
  x4hscompstat = col_double(),
  x4evratndclg = col_double(),
  x4hs2psmos = col_double()
)
</code></pre></div></div>

<p>Unlike the <code class="language-plaintext highlighter-rouge">readRDS()</code> function we’ve used before, <code class="language-plaintext highlighter-rouge">read_csv()</code> prints
out information about the data just read in. Nothing is wrong! The
<code class="language-plaintext highlighter-rouge">read_csv()</code> function, like many other functions in the tidyverse,
assumes you’d rather have more rather than less information and acts
accordingly. We can see that all the columns were read in as doubles
(<code class="language-plaintext highlighter-rouge">col_double()</code>). For other data (or if we had told <code class="language-plaintext highlighter-rouge">read_csv()</code> how to
parse the columns), we might see other column types like
<code class="language-plaintext highlighter-rouge">col_integer()</code>, <code class="language-plaintext highlighter-rouge">col_character()</code>, or <code class="language-plaintext highlighter-rouge">col_logical()</code>.</p>

<blockquote>
  <h4 id="quick-exercise-1">Quick exercise</h4>

  <p><code class="language-plaintext highlighter-rouge">readr::read_csv()</code> is special version of <code class="language-plaintext highlighter-rouge">readr::read_delim()</code>, which
can read various <em>delimited</em> file types, that is, tabular data in
which data cells are separated by a special character. What’s the
special character used to separate <em>CSV</em> files? Once you figure it
out, re-read in the data using <code class="language-plaintext highlighter-rouge">read_delim()</code>, being sure to set the
<code class="language-plaintext highlighter-rouge">delim</code> argument to the correct character.</p>
</blockquote>

<p><strong>NOTE</strong> When a function comes from a specific library, I will sometimes
signal that using <code class="language-plaintext highlighter-rouge">::</code> notation: <code class="language-plaintext highlighter-rouge">&lt;package&gt;::&lt;function&gt;</code>. Along as
you’ve installed the package, you can actually call functions in R
using this notation if you don’t want to load the library at the top of
the file (<em>e.g.</em> <code class="language-plaintext highlighter-rouge">library(tidyverse)</code>). We won’t do that. I use this
notation so it’s clear to you which R library a function comes from.
When see <code class="language-plaintext highlighter-rouge">readr::read_csv()</code>, that means the <code class="language-plaintext highlighter-rouge">read_csv()</code> function,
which is part of the {readr} library.</p>

<h1 id="example-data-analysis-task">Example data analysis task</h1>

<p>Let’s imagine we’ve been given the following data analysis task with the
HSLS09 data:</p>

<blockquote>
  <p><em>Figure out average differences in college degree expectations across
census regions; ignore missing values and use the higher of student
and parental expectations if an observation has both</em>.</p>
</blockquote>

<p>A primary skill (often unremarked upon) in data analytic work is
translation. Your advisor, IR director, funding agency director — even
collaborator — won’t speak to you in the language of R. Instead, it’s up
to you to (1) translate a research question into the discrete steps
coding steps necessary to provide an answer, and then (2) translate the
answer such that everyone understands what you’ve found.</p>

<!-- \\[ -->

<!-- \\text{Question}\\;\\;\\;  -->

<!-- \\overrightarrow{(translate)}\\;\\;\\;  -->

<!-- \\text{Data Steps}\\;\\;\\;  -->

<!-- \\overrightarrow{(translate)}\\;\\;\\; -->

<!-- \\text{Answer} -->

<!-- \\] -->

<p>What we need to do is some combination of the following:</p>

<ol>
  <li><strong>Select</strong> the variables we need</li>
  <li><strong>Mutate</strong> a new value that’s the higher of student and parental
degree expectations</li>
  <li><strong>Filter</strong> out observations with missing degree expectation values</li>
  <li><strong>Summarize</strong> the data within region to get average degree
expectation values</li>
  <li><strong>Arrange</strong> in order so it’s easier to rank and share</li>
</ol>

<p>Let’s do it!</p>

<h1 id="select-variables-columns"><strong>Select</strong> variables (columns)</h1>

<p>To choose variables, either when making a new data frame or dropping
them, use <code class="language-plaintext highlighter-rouge">select()</code>. Like the other <strong>{dplyr}</strong> functions we’ll use,
the first argument <code class="language-plaintext highlighter-rouge">select()</code> takes is the data frame (or tibble)
object. After that, we list the column names we want to keep.</p>

<p>Since we don’t want to overwrite our original data in memory, we’ll
create an new object called <code class="language-plaintext highlighter-rouge">df_tmp</code>)</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## select</span><span class="w">
</span><span class="n">df_tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">stu_id</span><span class="p">,</span><span class="w"> </span><span class="n">x1stuedexpct</span><span class="p">,</span><span class="w"> </span><span class="n">x1paredexpct</span><span class="p">,</span><span class="w"> </span><span class="n">x1region</span><span class="p">)</span><span class="w">

</span><span class="c1">## show</span><span class="w">
</span><span class="n">df_tmp</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 23,503 x 4
   stu_id x1stuedexpct x1paredexpct x1region
    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1  10001            8            6        2
 2  10002           11            6        1
 3  10003           10           10        4
 4  10004           10           10        3
 5  10005            6           10        3
 6  10006           10            8        3
 7  10007            8           11        1
 8  10008            8            6        1
 9  10009           11           11        3
10  10010            8            6        1
# … with 23,493 more rows
</code></pre></div></div>

<h1 id="mutate-data-into-new-forms"><strong>Mutate</strong> data into new forms</h1>

<p>To add variables and change existing ones, use the <code class="language-plaintext highlighter-rouge">mutate()</code> function.</p>

<p>Just like <code class="language-plaintext highlighter-rouge">select()</code>, the <code class="language-plaintext highlighter-rouge">mutate()</code> function takes the data frame as
the first argument, followed by <em>the stuff we want to do</em>. In this case,
<em>the stuff we want to do</em> is add a new column that is the larger of
<code class="language-plaintext highlighter-rouge">x1stuedexpct</code> and <code class="language-plaintext highlighter-rouge">x1paredexpct</code>. Some
<a href="https://en.wikipedia.org/wiki/Pseudocode">pseudocode</a> for making a new
column is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## pseudo code (not to be run)</span><span class="w">
</span><span class="n">mutate</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dataframe</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">new_var</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="o">&lt;</span><span class="n">old_var</span><span class="o">&gt;</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Sometimes, that <code class="language-plaintext highlighter-rouge">function()</code> could just be adding a value: <code class="language-plaintext highlighter-rouge">mutate(df,
col_of_ones = 1)</code>.</p>

<blockquote>
  <h4 id="quick-exercise-2">Quick exercise</h4>

  <p>Without assigning to any object (no <code class="language-plaintext highlighter-rouge">&lt;-</code>), type <code class="language-plaintext highlighter-rouge">mutate(df,
col_of_ones = 1)</code>. What do you get?</p>
</blockquote>

<p>Usually the function will be more interesting. In this case we need to
choose the bigger of two values. This is an ideal use case for the
<code class="language-plaintext highlighter-rouge">ifelse()</code> function, which works like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## pseudo code (not to be run)</span><span class="w">
</span><span class="n">ifelse</span><span class="p">(</span><span class="o">&lt;</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&gt;</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Using this logic within <code class="language-plaintext highlighter-rouge">mutate()</code>, we can test whether each student’s
degree expectation is higher than that of their parent; if true, we’ll
put the student’s value into the new variable — if false, we’ll put the
parent’s value into the new variable.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## mutate (notice that we use df_tmp now)</span><span class="w">
</span><span class="n">df_tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">high_expct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">x1stuedexpct</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x1paredexpct</span><span class="p">,</span><span class="w"> </span><span class="c1"># test</span><span class="w">
                                             </span><span class="n">x1stuedexpct</span><span class="p">,</span><span class="w">                </span><span class="c1"># if TRUE</span><span class="w">
                                             </span><span class="n">x1paredexpct</span><span class="p">))</span><span class="w">               </span><span class="c1"># if FALSE</span><span class="w">

</span><span class="c1">## show</span><span class="w">
</span><span class="n">df_tmp</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 23,503 x 5
   stu_id x1stuedexpct x1paredexpct x1region high_expct
    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1  10001            8            6        2          8
 2  10002           11            6        1         11
 3  10003           10           10        4         10
 4  10004           10           10        3         10
 5  10005            6           10        3         10
 6  10006           10            8        3         10
 7  10007            8           11        1         11
 8  10008            8            6        1          8
 9  10009           11           11        3         11
10  10010            8            6        1          8
# … with 23,493 more rows
</code></pre></div></div>

<p>Doing a quick “ocular test” of our first few rows, it seems like our new
variable is correct.</p>

<blockquote>
  <h4 id="quick-exercise-3">Quick exercise</h4>

  <p>What happens when the student and parent expectations are the same?
Does our <code class="language-plaintext highlighter-rouge">ifelse()</code> statement account for those situations? If so,
how?</p>
</blockquote>

<h1 id="filter-observations-rows"><strong>Filter</strong> observations (rows)</h1>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## get summary of our new variable</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">df_tmp</span><span class="o">$</span><span class="n">high_expct</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  -8    1    2    3    4    5    6    7    8    9   10   11 
1732   47 1399  110  830   89 2982  169 4257  152 5810 5926 
</code></pre></div></div>

<p>What do these values mean? What’s up with the negative values.</p>

<blockquote>
  <h4 id="quick-exercise-4">Quick exercise</h4>

  <p>Use the online codebook to figure out what these values mean.</p>
</blockquote>

<p>In R, missing values are technically stored as <code class="language-plaintext highlighter-rouge">NA</code>. But not all
statistical software uses the same values to represent missing values
(for example, Stata uses a dot <code class="language-plaintext highlighter-rouge">.</code>) NCES has decided to represent
missing values as a limited number of negative values. In this case,
<code class="language-plaintext highlighter-rouge">-8</code> represents a missing value.</p>

<p>How to handle missing values is a <strong>very</strong> important topic, one we could
spend all semester discussing. For now, we are just going to drop
observations with missing values; but be forewarned that how you handle
missing values can have real ramifications for the quality of your final
results.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## filter out missing values</span><span class="w">
</span><span class="n">df_tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">high_expct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">-8</span><span class="p">)</span><span class="w">

</span><span class="c1">## notice the number of rows now:</span><span class="w">
</span><span class="c1">## do they equal the first number minus the number of NAs from our table command?</span><span class="w">
</span><span class="n">df_tmp</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 21,771 x 5
   stu_id x1stuedexpct x1paredexpct x1region high_expct
    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1  10001            8            6        2          8
 2  10002           11            6        1         11
 3  10003           10           10        4         10
 4  10004           10           10        3         10
 5  10005            6           10        3         10
 6  10006           10            8        3         10
 7  10007            8           11        1         11
 8  10008            8            6        1          8
 9  10009           11           11        3         11
10  10010            8            6        1          8
# … with 21,761 more rows
</code></pre></div></div>

<blockquote>
  <h4 id="quick-exercise-5">Quick exercise</h4>

  <p>What does the logical operator <code class="language-plaintext highlighter-rouge">!=</code> mean? How else could we have
filtered our data?</p>
</blockquote>

<h1 id="summarize-data"><strong>Summarize</strong> data</h1>

<p>Now we’re ready to get the average. The <code class="language-plaintext highlighter-rouge">summarize()</code> command will allow
us to apply a summary measure, like <code class="language-plaintext highlighter-rouge">mean()</code>, to a column of our data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## get average (without storing)</span><span class="w">
</span><span class="n">summarize</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">high_expct_mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">high_expct</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 x 1
  high_expct_mean
            &lt;dbl&gt;
1            8.48
</code></pre></div></div>

<p>Overall, we can see that students and parents have high postsecondary
expectations on average: to earn some graduate credential beyond a
bachelor’s degree. However, this isn’t what we want. We want the values
across census regions.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## check our census regions</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">df_tmp</span><span class="o">$</span><span class="n">x1region</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
   1    2    3    4 
3383 5779 8846 3763 
</code></pre></div></div>

<p>We’re not missing any census data, which is good. To calculate our
average expectations, we need to use the <code class="language-plaintext highlighter-rouge">group_by()</code> function. This
function allows to set groups and perform other <strong>{dpylr}</strong> operations
<em>within</em> those groups. Right now, we’ll use it to get our summary.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## get expectations average within region</span><span class="w">
</span><span class="n">df_tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">x1region</span><span class="p">)</span><span class="w">

</span><span class="c1">## show grouping</span><span class="w">
</span><span class="n">df_tmp</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 21,771 x 5
# Groups:   x1region [4]
   stu_id x1stuedexpct x1paredexpct x1region high_expct
    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1  10001            8            6        2          8
 2  10002           11            6        1         11
 3  10003           10           10        4         10
 4  10004           10           10        3         10
 5  10005            6           10        3         10
 6  10006           10            8        3         10
 7  10007            8           11        1         11
 8  10008            8            6        1          8
 9  10009           11           11        3         11
10  10010            8            6        1          8
# … with 21,761 more rows
</code></pre></div></div>

<p>Notice the extra row at the second line now? <code class="language-plaintext highlighter-rouge">Groups: x1region [4]</code>
tells us that our data set is now grouped.</p>

<blockquote>
  <h4 id="quick-exercise-6">Quick exercise</h4>

  <p>What does the <code class="language-plaintext highlighter-rouge">[4]</code> mean?</p>
</blockquote>

<p>Now that our groups are set, we can get the summary we really wanted</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## get average (without storing)</span><span class="w">
</span><span class="n">df_tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarize</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">high_expct_mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">high_expct</span><span class="p">))</span><span class="w">

</span><span class="c1">## show</span><span class="w">
</span><span class="n">df_tmp</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 4 x 2
  x1region high_expct_mean
     &lt;dbl&gt;           &lt;dbl&gt;
1        1            8.62
2        2            8.44
3        3            8.49
4        4            8.42
</code></pre></div></div>

<p>Success! Expectations are similar across the country, but not the same.</p>

<h1 id="arrange-data"><strong>Arrange</strong> data</h1>

<p>As our final step, we’ll arrange our data frame from highest to lowest
(descending). For this, we’ll use <code class="language-plaintext highlighter-rouge">arrange()</code> and a special operator,
<code class="language-plaintext highlighter-rouge">desc()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## arrange from highest expectations (first row) to lowest</span><span class="w">
</span><span class="n">df_tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">(</span><span class="n">high_expct_mean</span><span class="p">))</span><span class="w">

</span><span class="c1">## show</span><span class="w">
</span><span class="n">df_tmp</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 4 x 2
  x1region high_expct_mean
     &lt;dbl&gt;           &lt;dbl&gt;
1        1            8.62
2        3            8.49
3        2            8.44
4        4            8.42
</code></pre></div></div>

<blockquote>
  <h4 id="quick-exercise-7">Quick exercise</h4>

  <p>What happens when you don’t include <code class="language-plaintext highlighter-rouge">desc()</code> around <code class="language-plaintext highlighter-rouge">high_expct_mean</code>?</p>
</blockquote>

<h1 id="write-out-updated-data"><strong>Write</strong> out updated data</h1>

<p>We can use this new data frame as a table in its own right or to make a
figure. For now, however, we’ll simply save it using the opposite of
<code class="language-plaintext highlighter-rouge">read_csv()</code>, <code class="language-plaintext highlighter-rouge">write_csv()</code>, which works like <code class="language-plaintext highlighter-rouge">writeRDS()</code> we’ve used
before.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## write with useful name</span><span class="w">
</span><span class="n">write_csv</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">dat_dir</span><span class="p">,</span><span class="w"> </span><span class="s2">"high_expct_mean_region.csv"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h1 id="pipes-">Pipes (<code class="language-plaintext highlighter-rouge">%&gt;%</code>)</h1>

<p>So far, we’ve performed each step of our analysis piecemeal. This is
fine, but a huge benefit of the <strong>{tidyverse}</strong> is that it allows users
to chain commands together using pipes.</p>

<p>Tidyverse pipes, <code class="language-plaintext highlighter-rouge">%&gt;%</code>, come from the <a href="http://magrittr.tidyverse.org">magrittr
package</a>.</p>

<p><span style="display:block;text-align:center">
<a href="https://www.fine-arts-museum.be/uploads/exhibitions/images/magritte_la_trahison_des_images_large@2x.jpg"><img src="https://www.rstudio.com/wp-content/uploads/2014/04/magrittr.png" alt="badge" /></a>
</span></p>

<p>Pipes take output from the left side and pipe it to the input of the
right side. So <code class="language-plaintext highlighter-rouge">sum(x)</code> can be rewritten as <code class="language-plaintext highlighter-rouge">x %&gt;% sum</code>: <code class="language-plaintext highlighter-rouge">x</code> outputs
itself and the pipe, <code class="language-plaintext highlighter-rouge">%&gt;%</code>, makes it the input for <code class="language-plaintext highlighter-rouge">sum()</code>.</p>

<blockquote>
  <h4 id="quick-exercise-8">Quick exercise</h4>

  <p>Store 1,000 random values in <code class="language-plaintext highlighter-rouge">x</code>: <code class="language-plaintext highlighter-rouge">x &lt;- rnorm(1000)</code>. Now run <code class="language-plaintext highlighter-rouge">sum(x)</code>
and <code class="language-plaintext highlighter-rouge">x %&gt;% sum</code>. Do you get the same thing?</p>
</blockquote>

<p>This may be a silly example (why would you do that?), but pipes are
powerful because they can be chained together. Functions can be nested
in R, but after too many, the code becomes difficult to parse since it
has to be read from the inside out. For this reason, many analysts run
one discrete function after another, saving output along the way. This
is what we did above.</p>

<p>Pipes allow functions to come one after another in the order of the work
being done, which is more legible, but in a connected fashion that is
cleaner and, sometimes, faster due to behind-the-scenes processing.</p>

<p>Let’s use <a href="https://twitter.com/_inundata/status/557980236130689024">Hadley’s canonical
example</a> to
make the readability comparison between nested functions and piped
functions clearer:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## foo_foo is an instance of a little bunny</span><span class="w">
</span><span class="n">foo_foo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">little_bunny</span><span class="p">()</span><span class="w">
</span><span class="c1">## adventures in base R must be read from the middle up and backwards</span><span class="w">
</span><span class="n">bop_on</span><span class="p">(</span><span class="w">
    </span><span class="n">scoop_up</span><span class="p">(</span><span class="w">
        </span><span class="n">hop_through</span><span class="p">(</span><span class="n">foo_foo</span><span class="p">,</span><span class="w"> </span><span class="n">forest</span><span class="p">),</span><span class="w">
        </span><span class="n">field_mouse</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">head</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="c1">## adventures w/ pipes start at the top and work down</span><span class="w">
</span><span class="n">foo_foo</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">hop_through</span><span class="p">(</span><span class="n">forest</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">scoop_up</span><span class="p">(</span><span class="n">field_mouse</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">bop_on</span><span class="p">(</span><span class="n">head</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h1 id="rewriting-our-analysis-using-pipes">Rewriting our analysis using pipes</h1>

<p>Returning to our example above, let’s connect the steps using pipes. To
start off, we can pipe our data to the <code class="language-plaintext highlighter-rouge">select()</code> command:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## pipe the original data frame into select</span><span class="w">
</span><span class="n">df_tmp_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">stu_id</span><span class="p">,</span><span class="w"> </span><span class="n">x1stuedexpct</span><span class="p">,</span><span class="w"> </span><span class="n">x1paredexpct</span><span class="p">,</span><span class="w"> </span><span class="n">x1region</span><span class="p">)</span><span class="w">

</span><span class="c1">## show</span><span class="w">
</span><span class="n">df_tmp_2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 23,503 x 4
   stu_id x1stuedexpct x1paredexpct x1region
    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1  10001            8            6        2
 2  10002           11            6        1
 3  10003           10           10        4
 4  10004           10           10        3
 5  10005            6           10        3
 6  10006           10            8        3
 7  10007            8           11        1
 8  10008            8            6        1
 9  10009           11           11        3
10  10010            8            6        1
# … with 23,493 more rows
</code></pre></div></div>

<p>Notice how we didn’t put <code class="language-plaintext highlighter-rouge">df</code> inside <code class="language-plaintext highlighter-rouge">select()</code>? That’s because <code class="language-plaintext highlighter-rouge">df</code> is
piped using <code class="language-plaintext highlighter-rouge">%&gt;%</code> into the first argument of <code class="language-plaintext highlighter-rouge">select()</code>. Since that’s
already accounted for, we can just start with the column names we want.</p>

<p>We can keep the chain going to our next step:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## same as before, but add mutate()</span><span class="w">
</span><span class="n">df_tmp_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1">## vars to select</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">stu_id</span><span class="p">,</span><span class="w"> </span><span class="n">x1stuedexpct</span><span class="p">,</span><span class="w"> </span><span class="n">x1paredexpct</span><span class="p">,</span><span class="w"> </span><span class="n">x1region</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1">## vars to add</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">high_expct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">x1stuedexpct</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x1paredexpct</span><span class="p">,</span><span class="w"> </span><span class="c1"># test</span><span class="w">
                               </span><span class="n">x1stuedexpct</span><span class="p">,</span><span class="w">                </span><span class="c1"># if TRUE</span><span class="w">
                               </span><span class="n">x1paredexpct</span><span class="p">))</span><span class="w">               </span><span class="c1"># if FALSE</span><span class="w">

</span><span class="c1">## show</span><span class="w">
</span><span class="n">df_tmp_2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 23,503 x 5
   stu_id x1stuedexpct x1paredexpct x1region high_expct
    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1  10001            8            6        2          8
 2  10002           11            6        1         11
 3  10003           10           10        4         10
 4  10004           10           10        3         10
 5  10005            6           10        3         10
 6  10006           10            8        3         10
 7  10007            8           11        1         11
 8  10008            8            6        1          8
 9  10009           11           11        3         11
10  10010            8            6        1          8
# … with 23,493 more rows
</code></pre></div></div>

<p>Notice how I included comments along the way? Since R ignores commented
lines (it’s as if they don’t exist), you can include within your piped
chain of commands. This is a good habit that collaborators and future
you will appreciate.</p>

<blockquote>
  <h4 id="quick-exercise-9">Quick exercise</h4>

  <p>Redo our initial analysis using a single chain. You don’t need to save
the output as a data file with <code class="language-plaintext highlighter-rouge">write_csv()</code>, but you should get the
same final four-row data frame we got before. If you want to formally
test, you can use the function <code class="language-plaintext highlighter-rouge">identical(df_tmp, df_tmp_2)</code> to see if
they are the same.</p>
</blockquote>



	<!-- <p> -->
	<!--   Updated:  -->
	<!-- </p> -->
      </section>
      <footer>
        <p>
  Benjamin Skinner</br>  
  Assistant Professor</br>  
  University of Florida</br>
  <a href="https://www.btskinner.io" class="iconlink" alt="Personal website">
    <i class="fas fa-home fa-lg"></i></a> | 
  <a href="https://github.com/btskinner" class="iconlink" alt="Github
								profile">
    <i class="fab fa-github fa-lg"></i></a> |
  <a href="https://twitter.com/btskinner" class="iconlink" alt="Twitter profile">
    <i class="fab fa-twitter fa-lg"></i></a>
</p>
<p>
  <small>
    <a href="https://pages.github.com">GitHub Pages</a> |
    <a href="https://github.com/orderedlist/minimal">Theme</a> |
    <a href="/edh7916/releases/">Releases</a>
  </small>
</p>

      </footer>
    </div>

    <!-- load Javascript if page requires it -->
    
    
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-63981025-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
